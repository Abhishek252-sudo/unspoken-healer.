<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unspoken Healer</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#eee; margin:0; }
    header { padding:20px; background:#222; color:#00f2fe; text-align:center; position:relative; }
    .auth-buttons { position:absolute; right:20px; top:20px; }
    .auth-buttons button { margin-left:5px; padding:6px 12px; background:#00f2fe; border:none; cursor:pointer; border-radius:6px; }
    #chatContainer { width:90%; max-width:600px; margin:40px auto; padding:20px; background:#222; border-radius:10px; }
    #chat { height:250px; overflow-y:auto; border:1px solid #555; margin-bottom:10px; padding:10px; }
    #controls input { width:75%; padding:10px; }
    #controls button { padding:10px; }
    .popup { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); justify-content:center; align-items:center; }
    .popup-content { background:#333; padding:20px; border-radius:8px; max-width:400px; text-align:center; }
    .popup input { width:90%; margin:8px 0; padding:8px; }
    .toggle-link { color:#00f2fe; cursor:pointer; display:block; margin-top:10px; }
  </style>
</head>
<body>

<header>
  <h1>Unspoken Healer ðŸŒŒ</h1>
  <div class="auth-buttons">
    <button id="loginBtn">Login</button>
    <button id="logoutBtn" style="display:none;">Logout</button>
  </div>
</header>

<div id="chatContainer">
  <h2>Your Private Chat</h2>
  <div id="chat"></div>
  <div id="controls">
    <input type="text" id="userInput" placeholder="Ask me anything..." disabled>
    <button id="sendBtn" disabled>Send</button>
  </div>
  <p id="status">Please login and agree to terms before chatting.</p>
</div>

<!-- Login/Register Popup -->
<div id="authPopup" class="popup">
  <div class="popup-content">
    <h2 id="popupTitle">Login</h2>
    <div id="loginForm">
      <input type="email" id="email" placeholder="Email"><br>
      <input type="password" id="password" placeholder="Password"><br>
      <button id="emailLogin">Login with Email</button>
      <hr>
      <input type="text" id="phone" placeholder="+91XXXXXXXXXX"><br>
      <div id="recaptcha-container"></div>
      <button id="phoneLogin">Send OTP</button>
      <input type="text" id="otp" placeholder="Enter OTP"><br>
      <button id="verifyOtp">Verify OTP</button>
      <span class="toggle-link" id="showRegister">Don't have an account? Register</span>
    </div>
    <div id="registerForm" style="display:none;">
      <input type="email" id="regEmail" placeholder="Email"><br>
      <input type="password" id="regPassword" placeholder="Password"><br>
      <button id="emailRegister">Register</button>
      <span class="toggle-link" id="showLogin">Already have an account? Login</span>
    </div>
    <br>
    <button onclick="document.getElementById('authPopup').style.display='none'">Close</button>
  </div>
</div>

<!-- Terms Popup -->
<div id="termsPopup" class="popup" style="display:flex;">
  <div class="popup-content">
    <h2>Before We Begin</h2>
    <p>Please agree to our 
      <a href="https://abhishek252-sudo.github.io/unspoken-healer/" target="_blank">Terms & Services</a>.
    </p>
    <label><input type="checkbox" id="agreeTerms"> I agree</label><br><br>
    <button id="continueBtn">Continue</button>
  </div>
</div>

<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyDpSDZydyYmVv_cB_xErTL_KiKx0l11dEM",
    authDomain: "unspokenhealer-f626a.firebaseapp.com",
    projectId: "unspokenhealer-f626a",
    storageBucket: "unspokenhealer-f626a.firebasestorage.app",
    messagingSenderId: "1009119300737",
    appId: "1:1009119300737:web:1ae60b6caf0c7389fc5180"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  let termsAgreed = false;
  const userInput = document.getElementById('userInput');
  const sendBtn = document.getElementById('sendBtn');
  const statusText = document.getElementById('status');

  document.getElementById('continueBtn').onclick = () => {
    if (document.getElementById('agreeTerms').checked) {
      termsAgreed = true;
      document.getElementById('termsPopup').style.display = 'none';
      if (auth.currentUser) enableChat(auth.currentUser.email || auth.currentUser.phoneNumber);
    } else {
      alert('Please agree to continue.');
    }
  };

  document.getElementById('loginBtn').onclick = () => {
    document.getElementById('authPopup').style.display = 'flex';
  };

  // Toggle forms
  document.getElementById('showRegister').onclick = () => {
    document.getElementById('loginForm').style.display = 'none';
    document.getElementById('registerForm').style.display = 'block';
    document.getElementById('popupTitle').innerText = 'Register';
  };
  document.getElementById('showLogin').onclick = () => {
    document.getElementById('registerForm').style.display = 'none';
    document.getElementById('loginForm').style.display = 'block';
    document.getElementById('popupTitle').innerText = 'Login';
  };

  // Email Login
  document.getElementById('emailLogin').onclick = () => {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    auth.signInWithEmailAndPassword(email, password)
      .then(() => {
        alert('Logged in with Email!');
        document.getElementById('authPopup').style.display = 'none';
      })
      .catch(err => alert(err.message));
  };

  // Email Register
  document.getElementById('emailRegister').onclick = () => {
    const email = document.getElementById('regEmail').value;
    const password = document.getElementById('regPassword').value;
    auth.createUserWithEmailAndPassword(email, password)
      .then(() => {
        alert('Account created!');
        document.getElementById('authPopup').style.display = 'none';
      })
      .catch(err => alert(err.message));
  };

  // Phone OTP
  window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container');
  document.getElementById('phoneLogin').onclick = () => {
    const phone = document.getElementById('phone').value;
    auth.signInWithPhoneNumber(phone, window.recaptchaVerifier)
      .then(conf => window.confirmationResult = conf)
      .catch(err => alert(err.message));
  };

  document.getElementById('verifyOtp').onclick = () => {
    const code = document.getElementById('otp').value;
    window.confirmationResult.confirm(code)
      .then(() => {
        alert('Phone verified!');
        document.getElementById('authPopup').style.display = 'none';
      })
      .catch(err => alert(err.message));
  };

  // Logout
  document.getElementById('logoutBtn').onclick = () => auth.signOut();

  auth.onAuthStateChanged(user => {
    if (user && termsAgreed) {
      enableChat(user.email || user.phoneNumber);
    } else {
      disableChat();
    }
  });

  function enableChat(name) {
    document.getElementById('loginBtn').style.display = 'none';
    document.getElementById('logoutBtn').style.display = 'inline-block';
    userInput.disabled = false;
    sendBtn.disabled = false;
    statusText.textContent = "Logged in as " + name;
  }

  function disableChat() {
    document.getElementById('loginBtn').style.display = 'inline-block';
    document.getElementById('logoutBtn').style.display = 'none';
    userInput.disabled = true;
    sendBtn.disabled = true;
    statusText.textContent = "Please login and agree to terms before chatting.";
  }
</script>

</body>
</html>
